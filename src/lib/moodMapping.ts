import { MoodType, MoodKey } from '@/types/library';

/** 気分 → キー */
export const moodToKeyMap: Record<MoodType, MoodKey> = {
  'ゾクゾクしたい': 'zokuzoku',
  '泣きたい': 'nakitai',
  'キュンとしたい': 'kyun',
  '元気が欲しい': 'genki',
  '不思議な世界へ': 'fushigi',
  'じっくり味わいたい': 'jikkuri',
  'ほっとしたい': 'hotto',
  '知的に楽しみたい': 'chiteki',
};

/** キー → 気分 */
export const keyToMoodMap: Record<MoodKey, MoodType> = {
  'zokuzoku': 'ゾクゾクしたい',
  'nakitai': '泣きたい',
  'kyun': 'キュンとしたい',
  'genki': '元気が欲しい',
  'fushigi': '不思議な世界へ',
  'jikkuri': 'じっくり味わいたい',
  'hotto': 'ほっとしたい',
  'chiteki': '知的に楽しみたい',
};

/** 検索用キーワード（一般語彙 + このラインナップ由来の固有語） */
export const moodToSearchKeywords: Record<MoodType, string[]> = {
  'ゾクゾクしたい': [
    // 一般語彙
    'ミステリ', 'サスペンス', 'スリル', '推理', '探偵', 'クライム', '犯罪', '復讐', '怪談', '怪異', 'ホラー',
    // 著者・シリーズ・固有名
    '東野圭吾', '伊坂幸太郎', '横溝正史', '江戸川乱歩', '米澤穂信', '柳広司', '堂場瞬一', '伊岡瞬', '太田愛', '柚月裕子', '依井貴裕',
    '図書館戦争', '黒牢城', 'グラスホッパー', 'ジョーカー・ゲーム', 'D坂の殺人事件', '犬神家の一族',
    'リング', '黒い家', 'ぼぎわんが、来る', '営繕かるかや怪異譚', '闇祓', '骨灰', '不夜城', '孤狼の血', 'テスカトリポカ',
  ],
  '泣きたい': [
    '感動', '家族', '親子', '赦し', '別れ', '再生', '友情', '涙', '人間ドラマ',
    'とんび', '氷点', '八月の母', 'お葉の医心帖', 'ナミヤ雑貨店の奇蹟', 'オオルリ流星群',
    '小説 すずめの戸締まり', '未来のミライ', '復活の日',
  ],
  'キュンとしたい': [
    '恋愛', 'ロマンス', '青春', '初恋', 'すれ違い', '学園', '両想い', '切ない',
    '小説 君の名は。', '秒速5センチメートル', '夜は短し歩けよ乙女', '視線から始まる', '朧の花嫁',
    '小説 すずめの戸締まり', '丸の内魔法少女ミラクリーナ',
  ],
  '元気が欲しい': [
    '成長', '挑戦', '努力', '友情', '希望', '勇気', '自己啓発', 'エール', '部活',
    'バッテリー', '図書館戦争', 'ビリギャル', '君の顔では泣けない', '青くて痛くて脆い',
    'アルケミスト 夢を旅した少年',
  ],
  '不思議な世界へ': [
    'ファンタジー', 'SF', '異世界', '魔法', '時間', '冒険', '伝奇', '怪異譚',
    '時をかける少女', 'きまぐれロボット', '復活の日', 'この本を盗む者は', '烏衣の華',
    '宵を待つ月の物語', '竜とそばかすの姫', 'おおかみこどもの雨と雪', 'バケモノの子', '未来のミライ',
  ],
  'じっくり味わいたい': [
    '古典', '名作', '文豪', '近代文学', '純文学', '短編名作', '詩', '哲学', '随筆',
    '太宰治', '夏目漱石', '芥川龍之介', '梶井基次郎', '三島由紀夫', '宮沢賢治', '坂口安吾', '夢野久作',
    '人間失格', '斜陽', '晩年', 'こゝろ', '吾輩は猫である', '羅生門', '檸檬', '銀河鉄道の夜', '注文の多い料理店',
    '不道徳教育講座', '汚れつちまつた悲しみに……', '100分間で楽しむ名作小説',
  ],
  'ほっとしたい': [
    '癒し', '日常', 'やさしい', '心温まる', 'グルメ', 'ビストロ', '再生', 'ほのぼの',
    'キッチン常夜灯', 'キッチン', 'ナミヤ雑貨店の奇蹟', 'オオルリ流星群', 'おそろし 三島屋変調百物語事始',
    'お葉の医心帖',
  ],
  '知的に楽しみたい': [
    '論理', '推理', 'パズル', '短編', '評論', '名言', '再読', '読み解き', '教養',
    '夜想曲', '高校入試', 'ジョーカー・ゲーム', '完全版 社会人大学人見知り学部 卒業見込',
    'ポケットに名言を', '(読んだふりしたけど)ぶっちゃけよく分からん、あの名作小説を面白く読む方法',
    '100分間で楽しむ名作小説 人間椅子', '100分間で楽しむ名作小説 夜市', '100分間で楽しむ名作小説 白痴', '100分間で楽しむ名作小説 瓶詰の地獄',
  ],
};

/** NDC マッピング（検索フィルタ用：大きく外さない安全寄りの設定） */
export const moodToNdcCategories: Record<MoodType, string[]> = {
  'ゾクゾクしたい': ['913'],               // 小説（ミステリ/サスペンス/ホラー）
  '泣きたい': ['913', '916'],               // 小説、手記・ルポ
  'キュンとしたい': ['913'],               // 小説（恋愛・青春）
  '元気が欲しい': ['159', '913', '916'],    // 人生訓、小説、手記
  '不思議な世界へ': ['913', '400', '500'], // 小説、自然科学、技術（SF要素のため）
  'じっくり味わいたい': ['910', '911', '914'], // 日本文学、詩歌、随筆
  'ほっとしたい': ['914', '913'],          // 随筆、小説（日常系）
  '知的に楽しみたい': ['000', '910', '020'],    // 総記、日本文学（評論含む）、図書・読書
};

export interface RuleBasedAdjustment {
  keywords: string[];
  adjustments: { mood: MoodType; scoreBoost: number }[];
}

/**
 * ルールベース補正
 * - 作品タイトル・著者名・シリーズ名・典型語を多数カバー
 * - boost は 0.05〜0.25 で重複可（最終スコアで正規化を想定）
 */
export const ruleBasedAdjustments: RuleBasedAdjustment[] = [
  // === ゾクゾク（ミステリ・ホラー）系 ===
  {
    keywords: ['殺人', '犯人', '密室', '探偵', '捜査', '犯罪', '復讐', '陰謀', '罠', '怪異', '怪談', '呪い'],
    adjustments: [
      { mood: 'ゾクゾクしたい', scoreBoost: 0.2 },
      { mood: '知的に楽しみたい', scoreBoost: 0.05 },
    ],
  },
  {
    keywords: ['東野圭吾','伊坂幸太郎','横溝正史','江戸川乱歩','米澤穂信','柳広司','堂場瞬一','伊岡瞬','太田愛','柚月裕子','依井貴裕'],
    adjustments: [
      { mood: 'ゾクゾクしたい', scoreBoost: 0.25 },
      { mood: '知的に楽しみたい', scoreBoost: 0.1 },
    ],
  },
  {
    keywords: ['リング','黒い家','ぼぎわんが、来る','営繕かるかや怪異譚','闇祓','骨灰'],
    adjustments: [{ mood: 'ゾクゾクしたい', scoreBoost: 0.25 }],
  },
  {
    keywords: ['D坂の殺人事件','犬神家の一族','ジョーカー・ゲーム','グラスホッパー','不夜城','孤狼の血','テスカトリポカ'],
    adjustments: [
      { mood: 'ゾクゾクしたい', scoreBoost: 0.2 },
      { mood: '知的に楽しみたい', scoreBoost: 0.05 },
    ],
  },

  // === 泣きたい（感動・家族愛） ===
  {
    keywords: ['家族','親子','母','父','赦し','喪失','再生','友情','別れ','手紙'],
    adjustments: [
      { mood: '泣きたい', scoreBoost: 0.2 },
      { mood: 'ほっとしたい', scoreBoost: 0.05 },
    ],
  },
  {
    keywords: ['とんび','氷点','八月の母','お葉の医心帖','ナミヤ雑貨店の奇蹟','オオルリ流星群'],
    adjustments: [
      { mood: '泣きたい', scoreBoost: 0.25 },
      { mood: 'ほっとしたい', scoreBoost: 0.1 },
    ],
  },

  // === キュン（恋愛・青春） ===
  {
    keywords: ['恋','恋愛','ロマンス','初恋','両想い','失恋','すれ違い','学園恋愛','胸キュン'],
    adjustments: [{ mood: 'キュンとしたい', scoreBoost: 0.22 }],
  },
  {
    keywords: ['新海誠','小説 君の名は。','秒速5センチメートル','小説 すずめの戸締まり','夜は短し歩けよ乙女','視線から始まる','朧の花嫁'],
    adjustments: [
      { mood: 'キュンとしたい', scoreBoost: 0.25 },
      { mood: '不思議な世界へ', scoreBoost: 0.05 },
    ],
  },

  // === 元気（青春・挑戦・自己啓発） ===
  {
    keywords: ['挑戦','努力','部活','友情','逆転','成長','自己啓発','夢','目標','合格'],
    adjustments: [{ mood: '元気が欲しい', scoreBoost: 0.22 }],
  },
  {
    keywords: ['バッテリー','図書館戦争','学年ビリのギャル','アルケミスト 夢を旅した少年','君の顔では泣けない','青くて痛くて脆い'],
    adjustments: [{ mood: '元気が欲しい', scoreBoost: 0.25 }],
  },

  // === 不思議（SF・ファンタジー） ===
  {
    keywords: ['SF','ファンタジー','異世界','魔法','時間移動','タイムリープ','伝奇','民俗','精霊','妖'],
    adjustments: [{ mood: '不思議な世界へ', scoreBoost: 0.24 }],
  },
  {
    keywords: ['時をかける少女','きまぐれロボット','復活の日','この本を盗む者は','烏衣の華','宵を待つ月の物語','竜とそばかすの姫','おおかみこどもの雨と雪','バケモノの子','未来のミライ'],
    adjustments: [{ mood: '不思議な世界へ', scoreBoost: 0.25 }],
  },

  // === じっくり（文芸・古典） ===
  {
    keywords: ['文豪','純文学','古典','近代文学','短編名作','詩','随筆','哲学','私小説'],
    adjustments: [
      { mood: 'じっくり味わいたい', scoreBoost: 0.24 },
      { mood: '知的に楽しみたい', scoreBoost: 0.05 },
    ],
  },
  {
    keywords: ['太宰治','夏目漱石','芥川龍之介','梶井基次郎','三島由紀夫','宮沢賢治','坂口安吾','夢野久作'],
    adjustments: [{ mood: 'じっくり味わいたい', scoreBoost: 0.25 }],
  },
  {
    keywords: ['人間失格','斜陽','晩年','こゝろ','吾輩は猫である','羅生門','檸檬','銀河鉄道の夜','注文の多い料理店','不道徳教育講座','汚れつちまつた悲しみに……'],
    adjustments: [{ mood: 'じっくり味わいたい', scoreBoost: 0.25 }],
  },

  // === ほっと（癒し・日常） ===
  {
    keywords: ['癒し','日常','やさしい','あたたかい','グルメ','ビストロ','人情','穏やか','ほのぼの'],
    adjustments: [{ mood: 'ほっとしたい', scoreBoost: 0.24 }],
  },
  {
    keywords: ['キッチン常夜灯','キッチン','ナミヤ雑貨店の奇蹟','オオルリ流星群','お葉の医心帖'],
    adjustments: [
      { mood: 'ほっとしたい', scoreBoost: 0.25 },
      { mood: '泣きたい', scoreBoost: 0.05 },
    ],
  },

  // === 知的（推理・評論・再読） ===
  {
    keywords: ['論理','パズル','トリック','思考実験','評論','読書法','名言','再読','入門','ガイド'],
    adjustments: [{ mood: '知的に楽しみたい', scoreBoost: 0.24 }],
  },
  {
    keywords: ['夜想曲','高校入試','ジョーカー・ゲーム','ポケットに名言を','完全版 社会人大学人見知り学部 卒業見込','(読んだふりしたけど)ぶっちゃけよく分からん'],
    adjustments: [{ mood: '知的に楽しみたい', scoreBoost: 0.25 }],
  },

  // === 医療・闘病など（既存ルールの置換） ===
  {
    keywords: ['医療','闘病','病気','看護','臨床'],
    adjustments: [
      { mood: '泣きたい', scoreBoost: 0.2 },
      { mood: 'ほっとしたい', scoreBoost: 0.08 },
    ],
  },
  // 旅・異国は「不思議」と「元気」に寄せる
  {
    keywords: ['旅','旅行','異国','紀行','冒険'],
    adjustments: [
      { mood: '不思議な世界へ', scoreBoost: 0.18 },
      { mood: '元気が欲しい', scoreBoost: 0.08 },
    ],
  },
];
